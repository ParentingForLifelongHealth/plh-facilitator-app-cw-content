{
  "flow_type": "template",
  "flow_name": "pending_reports",
  "status": "released",
  "rows": [
    {
      "name": "number_delivered_sessions",
      "comments": "Initializing variables"
    },
    {
      "name": "number_pending_reports"
    },
    {
      "name": "module_id"
    },
    {
      "name": "module_title"
    },
    {
      "name": "modules_report_id"
    },
    {
      "name": "show_limit",
      "value": 2
    },
    {
      "type": "begin_data_items",
      "name": "counting_delivered",
      "value": "@data.report_answers",
      "action_list": "data_changed | set_local : number_delivered_sessions : @items.length -1;",
      "comments": "Counts all sessions delivered"
    },
    {
      "type": "end_data_items"
    },
    {
      "type": "begin_data_items",
      "name": "counting_pending",
      "value": "@data.report_answers",
      "action_list": "data_changed | set_local : number_pending_reports : @items.length -1;",
      "parameter_list": "filter: @item.pending;",
      "comments": "Counts pending reports "
    },
    {
      "type": "end_data_items"
    },
    {
      "type": "text",
      "name": "test_delivered",
      "value": "delivered = @local.number_delivered_sessions",
      "condition": false,
      "exclude_from_translation": true
    },
    {
      "type": "text",
      "name": "test_pending",
      "value": "pending = @local.number_pending_reports",
      "condition": false,
      "exclude_from_translation": true
    },
    {
      "comments": "If no sessions have been completed"
    },
    {
      "type": "title",
      "name": "text_no_pending_reports_1",
      "value": "ðŸŽŠ No Pending Reports",
      "condition": "@local.number_delivered_sessions == 0"
    },
    {
      "type": "title",
      "name": "text_initial",
      "value": "ðŸš€ Your parents are waiting! Once you deliver your first session, your reports will appear here.",
      "condition": "@local.number_delivered_sessions == 0"
    },
    {
      "comments": "If reports are missing"
    },
    {
      "type": "begin_display_group",
      "condition": "@local.number_delivered_sessions > 0 && @local.number_pending_reports > 0",
      "comments": "Title with number of pending reports and show all button in case there are more than 2 pending reports"
    },
    {
      "type": "title",
      "name": "text_pending_reports",
      "value": "@local.number_pending_reports Pending Reports",
      "style_list": "flex:1;",
      "condition": "@local.number_delivered_sessions > 1"
    },
    {
      "type": "title",
      "name": "text_pending_reports",
      "value": "@local.number_pending_reports Pending Report",
      "style_list": "flex:1;",
      "condition": "@local.number_delivered_sessions == 1"
    },
    {
      "type": "button",
      "name": "show_all_button",
      "value": "Show All",
      "action_list": "click | set_local: show_limit: @local.number_pending_reports;",
      "parameter_list": "variant: card;",
      "condition": "@local.number_pending_reports > 2 && @local.show_limit !== @local.number_pending_reports",
      "comments": "Sets the limit of reports to show from 2 to the total number of reports"
    },
    {
      "type": "button",
      "name": "show_all_button",
      "value": "Show Less",
      "action_list": "click | set_local: show_limit: 2;",
      "parameter_list": "variant: card;",
      "condition": "@local.number_pending_reports > 2 && @local.show_limit == @local.number_pending_reports",
      "comments": "Sets the limit of reports to show from 2 to the total number of reports"
    },
    {
      "type": "end_display_group"
    },
    {
      "type": "begin_display_group",
      "parameter_list": "style: column",
      "condition": "@local.number_delivered_sessions > 0 && @local.number_pending_reports > 0",
      "comments": "List of pending reports"
    },
    {
      "type": "begin_data_items",
      "value": "@data.report_answers",
      "parameter_list": "filter: @item.pending && !(@item.id=='text');\nlimit: @local.show_limit;",
      "comments": "Looks at all pending reports up to the limit"
    },
    {
      "name": "module_id",
      "value": "@item.module_id"
    },
    {
      "name": "group_id",
      "value": "@item.group_id"
    },
    {
      "name": "module_name",
      "value": "@data.modules.@local.module_id.title"
    },
    {
      "name": "modules_report_id",
      "value": "@data.modules.@local.module_id.report_id"
    },
    {
      "type": "begin_display_group"
    },
    {
      "type": "text",
      "name": "module_title_text",
      "value": "@local.module_name",
      "style_list": "flex:1;\nmargin-bottom: 12px;"
    },
    {
      "type": "button",
      "name": "submit_button",
      "value": "Submit",
      "action_list": "click | set_field: current_report_no: @item.id;\nclick | set_field: current_group_no: @item.group_id;\nclick | set_field: current_module: @local.module_title;\nclick | set_field: current_report_id: @local.modules_report_id;\nclick | go_to: edit_report;",
      "comments": "taken from here, modified appropriately?: \n\n \n         \nclick | set_field: current_report_no: @local.answer_id;\nclick | set_field: current_group_no: @local.group_id;\nclick | set_field: current_module: @local.module_name;\nclick | set_field: current_report_id: @local.report_id;\nclick | go_to: edit_report;\n"
    },
    {
      "type": "end_display_group"
    },
    {
      "type": "begin_data_items",
      "value": "@data.parent_groups",
      "comments": "Looks for the name of the parent group"
    },
    {
      "type": "text",
      "name": "group_name",
      "value": "@item.text",
      "style_list": "font-size: 12px;Â \ncolor: #46607F;\nmargin-top: -10px;\nmargin-bottom: 12px;\n",
      "condition": "@local.group_id == @item.name"
    },
    {
      "type": "end_data_items"
    },
    {
      "type": "end_data_items"
    },
    {
      "type": "end_display_group"
    },
    {
      "comments": "If no reports are missing"
    },
    {
      "type": "begin_display_group",
      "parameter_list": "style: column",
      "condition": "@local.number_delivered_sessions > 0 && @local.number_pending_reports == 0 "
    },
    {
      "type": "title",
      "name": "text_no_pending_reports_1",
      "value": "ðŸŽŠ No Pending Reports"
    },
    {
      "type": "text",
      "name": "text_no_pending_reports_2",
      "value": "Great job! Youâ€™ve completed all reports!",
      "parameter_list": "style: contextual"
    },
    {
      "type": "end_display_group"
    }
  ]
}